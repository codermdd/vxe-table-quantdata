"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ctor=_interopRequireDefault(require("xe-utils/ctor")),_tools=require("../../tools"),_util=require("./util");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);var r=o.call(e,t||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var cellType="header",_default={name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,tableGroupColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},mounted:function(){var e=this.$parent,t=this.$el,o=this.$refs,r=this.fixedType,l=e.elemStore,i="".concat(r||"main","-header-");l["".concat(i,"wrapper")]=t,l["".concat(i,"table")]=o.table,l["".concat(i,"colgroup")]=o.colgroup,l["".concat(i,"list")]=o.thead,l["".concat(i,"xSpace")]=o.xSpace,l["".concat(i,"repair")]=o.repair},render:function(w){var P=this,e=this._e,S=this.$parent,T=this.fixedType,t=this.headerColumn,o=this.fixedColumn,r=this.tableColumn,$=S.$listeners,l=S.tId,z=S.resizable,M=S.border,D=S.columnKey,i=S.headerRowClassName,W=S.headerCellClassName,n=S.headerRowStyle,k=S.headerCellStyle,I=S.showHeaderOverflow,R=S.headerAlign,A=S.align,H=S.highlightCurrentColumn,q=S.currentColumn,E=S.mouseConfig,L=S.scrollXLoad,N=S.overflowX,a=S.scrollbarWidth,O=S.getColumnIndex,B=S.sortOpts;return L&&T&&(r=o),w("div",{class:["vxe-table--header-wrapper",T?"fixed-".concat(T,"--wrapper"):"body--wrapper"],attrs:{"data-tid":l}},[T?e():w("div",{class:"vxe-body--x-space",ref:"xSpace"}),w("table",{class:"vxe-table--header",attrs:{"data-tid":l,cellspacing:0,cellpadding:0,border:0},ref:"table"},[w("colgroup",{ref:"colgroup"},r.map(function(e,t){return w("col",{attrs:{name:e.id},key:t})}).concat(a?[w("col",{attrs:{name:"col_gutter"}})]:[])),w("thead",{ref:"thead"},t.map(function(x,C){return w("tr",{class:["vxe-header--row",i?_ctor.default.isFunction(i)?i({$table:S,$rowIndex:C,fixed:T,type:cellType}):i:""],style:n?_ctor.default.isFunction(n)?n({$table:S,$rowIndex:C,fixed:T,type:cellType}):n:null},x.map(function(e,t){var o,r=e.showHeaderOverflow,l=e.headerAlign,i=e.align,n=e.headerClassName,a=e.children&&e.children.length,s=T?e.fixed!==T&&!a:e.fixed&&N,c=_ctor.default.isUndefined(r)||_ctor.default.isNull(r)?I:r,d=l||i||R||A,u="ellipsis"===c,f="title"===c,p=!0===c||"tooltip"===c,m=f||p||u,h={},y=e.filters&&e.filters.some(function(e){return e.checked}),b=O(e),v=S.getVTColumnIndex(e),_={$table:S,$rowIndex:C,column:e,columnIndex:b,$columnIndex:t,_columnIndex:v,fixed:T,type:cellType,isHidden:s,hasFilter:y};L&&!m&&(u=m=!0),(H||$["header-cell-click"]||E||"cell"===B.trigger)&&(h.click=function(e){return S.triggerHeaderCellClickEvent(e,_)}),$["header-cell-dblclick"]&&(h.dblclick=function(e){return S.triggerHeaderCellDBLClickEvent(e,_)}),E&&(h.mousedown=function(e){return S.triggerHeaderCellMousedownEvent(e,_)});var g="seq"===e.type||"index"===e.type?"seq":e.type;return w("th",{class:["vxe-header--column",e.id,(o={},_defineProperty(o,"col--".concat(d),d),_defineProperty(o,"col--".concat(g),g),_defineProperty(o,"col--last",t===x.length-1),_defineProperty(o,"col--fixed",e.fixed),_defineProperty(o,"col--group",a),_defineProperty(o,"col--ellipsis",m),_defineProperty(o,"fixed--hidden",s),_defineProperty(o,"is--sortable",e.sortable),_defineProperty(o,"is--filter",!!e.filters),_defineProperty(o,"filter--active",y),_defineProperty(o,"col--current",q===e),o),_tools.UtilTools.getClass(n,_),_tools.UtilTools.getClass(W,_)],attrs:{"data-colid":e.id,colspan:1<e.colSpan?e.colSpan:null,rowspan:1<e.rowSpan?e.rowSpan:null},style:k?_ctor.default.isFunction(k)?k(_):k:null,on:h,key:D||a?e.id:t},[w("div",{class:["vxe-cell",{"c--title":f,"c--tooltip":p,"c--ellipsis":u}]},e.renderHeader(w,_)),!s&&!a&&(_ctor.default.isBoolean(e.resizable)?e.resizable:z)?w("div",{class:["vxe-resizable",{"is--line":!M||"none"===M}],on:{mousedown:function(e){return P.resizeMousedown(e,_)}}}):null])}).concat(a?[w("th",{class:"vxe-header--gutter col--gutter"})]:[]))}))]),w("div",{class:"vxe-table--header-border-line",ref:"repair"})])},methods:{uploadColumn:function(){this.headerColumn=this.isGroup?(0,_util.convertToRows)(this.tableGroupColumn):[this.$parent.scrollXLoad&&this.fixedType?this.fixedColumn:this.tableColumn]},resizeMousedown:function(e,t){var o=t.column,r=this.$parent,l=this.$el,i=this.fixedType,n=r.$refs,a=n.tableBody,s=n.leftContainer,c=n.rightContainer,d=n.resizeBar,u=e.target,f=e.clientX,p=t.cell=u.parentNode,m=0,h=a.$el,y=_tools.DomTools.getOffsetPos(u,l),b=u.clientWidth,v=Math.floor(b/2),_=_tools.UtilTools.getColMinWidth(t)-v,g=y.left-p.clientWidth+b+_,x=y.left+v,C=document.onmousemove,w=document.onmouseup,P="left"===i,S="right"===i,T=0;if(P||S){for(var $=P?"nextElementSibling":"previousElementSibling",z=p[$];z&&!_tools.DomTools.hasClass(z,"fixed--hidden");)_tools.DomTools.hasClass(z,"col--group")||(T+=z.offsetWidth),z=z[$];S&&c&&(x=c.offsetLeft+T)}var M=function(e){e.stopPropagation(),e.preventDefault();var t=e.clientX-f,o=x+t,r=i?0:h.scrollLeft;P?o=Math.min(o,(c?c.offsetLeft:h.clientWidth)-T-_):S?(g=(s?s.clientWidth:0)+T+_,o=Math.min(o,x+p.clientWidth-_)):g=Math.max(h.scrollLeft,g),m=Math.max(o,g),d.style.left="".concat(m-r,"px")};r._isResize=!0,_tools.DomTools.addClass(r.$el,"drag--resize"),d.style.display="block",document.onmousemove=M,document.onmouseup=function(){document.onmousemove=C,document.onmouseup=w,o.resizeWidth=o.renderWidth+(S?x-m:m-x),d.style.display="none",r._isResize=!1,r._lastResizeTime=Date.now(),r.analyColumnWidth(),r.recalculate(!0).then(function(){r.saveCustomResizable(),r.updateCellAreas(),r.emitEvent("resizable-change",t,e)}),_tools.DomTools.removeClass(r.$el,"drag--resize")},M(e),r.closeMenu()}}};exports.default=_default;