"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,i){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var n=i.call(e,t||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var _default2={name:"VxePulldown",props:{disabled:Boolean,placement:String,size:{type:String,default:function(){return _conf.default.size}},destroyOnClose:Boolean,transfer:Boolean},data:function(){return{inited:!1,panelIndex:0,panelStyle:null,panelPlacement:null,currentValue:null,visiblePanel:!1,animatVisible:!1,isActivated:!1}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize}},created:function(){_tools.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent)},beforeDestroy:function(){var e=this.$refs.panel;e&&e.parentNode&&e.parentNode.removeChild(e)},destroyed:function(){_tools.GlobalEvent.off(this,"mousewheel"),_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"blur")},render:function(e){var t,i,n=this.$scopedSlots,o=this.inited,l=this.vSize,s=this.destroyOnClose,a=this.transfer,r=this.isActivated,d=this.disabled,u=this.animatVisible,f=this.visiblePanel,c=this.panelStyle,h=this.panelPlacement,p=n.default,v=n.dropdown;return e("div",{class:["vxe-pulldown",(t={},_defineProperty(t,"size--".concat(l),l),_defineProperty(t,"is--visivle",f),_defineProperty(t,"is--disabled",d),_defineProperty(t,"is--active",r),t)]},[e("div",{ref:"content",class:"vxe-pulldown--content"},p?p.call(this,{$pulldown:this},e):[]),e("div",{ref:"panel",class:["vxe-table--ignore-clear vxe-pulldown--panel",(i={},_defineProperty(i,"size--".concat(l),l),_defineProperty(i,"is--transfer",a),_defineProperty(i,"animat--leave",u),_defineProperty(i,"animat--enter",f),i)],attrs:{"data-placement":h},style:c},v?!o||s&&!f&&!u?[]:v.call(this,{$pulldown:this},e):[])])},methods:{handleGlobalMousewheelEvent:function(e){var t=this.$refs,i=this.disabled,n=this.visiblePanel;i||n&&(_tools.DomTools.getEventTargetNode(e,t.panel).flag?this.updatePlacement():(this.hidePanel(),this.$emit("hide-panel",{$event:e})))},handleGlobalMousedownEvent:function(e){var t=this.$refs,i=this.$el,n=this.disabled,o=this.visiblePanel;n||(this.isActivated=_tools.DomTools.getEventTargetNode(e,i).flag||_tools.DomTools.getEventTargetNode(e,t.panel).flag,o&&!this.isActivated&&(this.hidePanel(),this.$emit("hide-panel",{$event:e})))},handleGlobalBlurEvent:function(e){this.visiblePanel&&(this.hidePanel(),this.$emit("hide-panel",{$event:e}))},updateZindex:function(){this.panelIndex<_tools.UtilTools.getLastZIndex()&&(this.panelIndex=_tools.UtilTools.nextZIndex())},isPanelVisible:function(){return this.visiblePanel},togglePanel:function(){return this.visiblePanel?this.hidePanel():this.showPanel()},showPanel:function(){var t=this;return this.inited||(this.inited=!0,this.transfer&&document.body.appendChild(this.$refs.panel)),new Promise(function(e){t.disabled?e(t.$nextTick()):(clearTimeout(t.hidePanelTimeout),t.isActivated=!0,t.animatVisible=!0,setTimeout(function(){t.visiblePanel=!0,t.updatePlacement(),setTimeout(function(){e(t.updatePlacement())},40)},10),t.updateZindex())})},hidePanel:function(){var t=this;return this.visiblePanel=!1,new Promise(function(e){t.animatVisible?t.hidePanelTimeout=setTimeout(function(){t.animatVisible=!1,e(t.$nextTick())},350):e(t.$nextTick())})},updatePlacement:function(){var y=this;return this.$nextTick().then(function(){var e=y.$refs,t=y.transfer,i=y.placement,n=y.panelIndex;if(y.visiblePanel){var o=e.panel,l=e.content;if(o&&l){var s=l.offsetHeight,a=l.offsetWidth,r=o.offsetHeight,d=o.offsetWidth,u={zIndex:n},f=_tools.DomTools.getAbsolutePos(l),c=f.boundingTop,h=f.boundingLeft,p=f.visibleHeight,v=f.visibleWidth,b="bottom";if(t){var m=h,P=c+s;"top"===i?(b="top",P=c-r):i||(p<P+r+5&&(b="top",P=c-r),P<5&&(b="bottom",P=c+s)),v<m+d+5&&(m-=m+d+5-v),m<5&&(m=5),Object.assign(u,{left:"".concat(m,"px"),top:"".concat(P,"px"),minWidth:"".concat(a,"px")})}else"top"===i?(b="top",u.bottom="".concat(s,"px")):i||p<c+s+r&&5<c-s-r&&(b="top",u.bottom="".concat(s,"px"));y.panelStyle=u,y.panelPlacement=b}}return y.$nextTick()})}}};exports.default=_default2;