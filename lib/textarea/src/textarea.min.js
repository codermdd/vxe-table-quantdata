"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var autoTxtElem,_ctor=_interopRequireDefault(require("xe-utils/ctor")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);var r=i.call(t,e||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var _default2={name:"VxeTextarea",props:{value:[String,Number],name:String,readonly:Boolean,disabled:Boolean,placeholder:String,maxlength:[String,Number],rows:{type:[String,Number],default:2},showWordCount:Boolean,autosize:[Boolean,Object],form:String,resize:{type:String,default:function(){return _conf.default.textarea.resize}},size:{type:String,default:function(){return _conf.default.textarea.size||_conf.default.size}}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},inputCount:function(){return _ctor.default.getSize(this.value)},isCountError:function(){return this.maxlength&&this.inputCount>_ctor.default.toNumber(this.maxlength)},defaultEvents:function(){var i=this,r={};return _ctor.default.each(this.$listeners,function(t,e){-1===["change"].indexOf(e)&&(r[e]=i.triggerEvent)}),r.input=this.inputEvent,r},sizeOpts:function(){return Object.assign({minRows:1,maxRows:10},_conf.default.textarea.autosize,this.autosize)}},watch:{value:function(){this.updateAutoTxt()}},created:function(){autoTxtElem||(autoTxtElem=document.createElement("div"),document.body.appendChild(autoTxtElem))},mounted:function(){this.updateAutoTxt(),this.handleResize()},render:function(t){var e,i=this.defaultEvents,r=this.value,o=this.vSize,n=this.name,a=this.form,u=this.resize,s=this.placeholder,l=this.readonly,c=this.disabled,f=this.maxlength,d=this.autosize,h=this.showWordCount,p={name:n,form:a,placeholder:s,maxlength:f,readonly:l,disabled:c};return s&&(p.placeholder=_tools.UtilTools.getFuncText(s)),t("div",{class:["vxe-textarea",(e={},_defineProperty(e,"size--".concat(o),o),_defineProperty(e,"is--autosize",d),_defineProperty(e,"is--disabled",c),e)]},[t("textarea",{ref:"textarea",class:"vxe-textarea--inner",domProps:{value:r},attrs:p,style:u?{resize:u}:null,on:i}),h?t("span",{class:["vxe-textarea--count",{"is--error":this.isCountError}]},"".concat(this.inputCount).concat(f?"/".concat(f):"")):null])},methods:{focus:function(){return this.$refs.textarea.focus(),this.$nextTick()},blur:function(){return this.$refs.textarea.blur(),this.$nextTick()},triggerEvent:function(t){var e=this.value;this.$emit(t.type,{value:e,$event:t},t)},emitUpdate:function(t,e){this.value!==t&&(this.$emit("input",t),this.$emit("change",{value:t,$event:e}))},inputEvent:function(t){this.emitUpdate(t.target.value,t),this.handleResize()},updateAutoTxt:function(){var t=this.$refs,e=this.value,i=this.size;if(this.autosize){var r=t.textarea,o=getComputedStyle(r);autoTxtElem.className=["vxe-textarea--autosize",i?"size--".concat(i):""].join(" "),autoTxtElem.style.width="".concat(r.clientWidth,"px"),autoTxtElem.style.padding=o.padding,autoTxtElem.innerHTML=(""+(e||"　")).replace(/\n$/,"\n　")}},handleResize:function(){var d=this;this.autosize&&this.$nextTick(function(){var t=d.$refs,e=d.sizeOpts,i=e.minRows,r=e.maxRows,o=t.textarea,n=autoTxtElem.clientHeight,a=getComputedStyle(o),u=_ctor.default.toNumber(a.lineHeight),s=_ctor.default.toNumber(a.paddingTop)+_ctor.default.toNumber(a.paddingBottom)+_ctor.default.toNumber(a.borderTopWidth)+_ctor.default.toNumber(a.borderBottomWidth),l=(n-s)/u,c=l&&/[0-9]/.test(l)?l:Math.floor(l)+1,f=c;c<i?f=i:r<c&&(f=r),o.style.height="".concat(f*u+s,"px")})}}};exports.default=_default2;