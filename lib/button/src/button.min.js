"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ctor=_interopRequireDefault(require("xe-utils/ctor")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _defineProperty(t,e,n){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);var o=n.call(t,e||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var _default2={name:"VxeButton",props:{type:String,size:{type:String,default:function(){return _conf.default.button.size||_conf.default.size}},name:[String,Number],content:String,placement:String,status:String,icon:String,round:Boolean,circle:Boolean,disabled:Boolean,loading:Boolean,destroyOnClose:Boolean,transfer:{type:Boolean,default:function(){return _conf.default.button.transfer}}},data:function(){return{inited:!1,showPanel:!1,animatVisible:!1,panelIndex:0,panelStyle:null,panelPlacement:null}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},isText:function(){return"text"===this.type},isFormBtn:function(){return-1<["submit","reset","button"].indexOf(this.type)},btnType:function(){return this.isText?this.type:"button"},btnStatus:function(){return this.status||("primary"===this.type?this.type:null)}},created:function(){"primary"===this.type&&_tools.UtilTools.warn("vxe.error.delProp",["type=primary","status=primary"]),_tools.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent)},beforeDestroy:function(){var t=this.$refs.panel;t&&t.parentNode&&t.parentNode.removeChild(t)},destroyed:function(){_tools.GlobalEvent.off(this,"mousewheel")},render:function(t){var e,n,o,i,s=this,r=this.$scopedSlots,a=this.$listeners,l=this.inited,u=this.type,c=this.destroyOnClose,d=this.isFormBtn,f=this.btnStatus,p=this.btnType,h=this.vSize,m=this.name,v=this.disabled,b=this.loading,y=this.showPanel,_=this.animatVisible,P=this.panelPlacement,x=r.dropdowns;return x?t("div",{class:["vxe-button--dropdown",(e={},_defineProperty(e,"size--".concat(h),h),_defineProperty(e,"is--active",y),e)]},[t("button",{ref:"btn",class:["vxe-button","type--".concat(p),(n={},_defineProperty(n,"size--".concat(h),h),_defineProperty(n,"theme--".concat(f),f),_defineProperty(n,"is--round",this.round),_defineProperty(n,"is--circle",this.circle),_defineProperty(n,"is--disabled",v||b),_defineProperty(n,"is--loading",b),n)],attrs:{name:m,type:d?u:"button",disabled:v||b},on:Object.assign({mouseenter:this.mouseenterTargetEvent,mouseleave:this.mouseleaveEvent},_ctor.default.objectMap(a,function(t,e){return function(t){return s.$emit(e,{$event:t},t)}}))},this.renderContent(t).concat([t("i",{class:"vxe-button--dropdown-arrow ".concat(_conf.default.icon.BUTTON_DROPDOWN)})])),t("div",{ref:"panel",class:["vxe-button--dropdown-panel",(o={},_defineProperty(o,"size--".concat(h),h),_defineProperty(o,"animat--leave",_),_defineProperty(o,"animat--enter",y),o)],attrs:{"data-placement":P},style:this.panelStyle},l?[t("div",{class:"vxe-button--dropdown-wrapper",on:{click:this.clickDropdownEvent,mouseenter:this.mouseenterEvent,mouseleave:this.mouseleaveEvent}},c&&!y?[]:x.call(this,{},t))]:null)]):t("button",{ref:"btn",class:["vxe-button","type--".concat(p),(i={},_defineProperty(i,"size--".concat(h),h),_defineProperty(i,"theme--".concat(f),f),_defineProperty(i,"is--round",this.round),_defineProperty(i,"is--circle",this.circle),_defineProperty(i,"is--disabled",v||b),_defineProperty(i,"is--loading",b),i)],attrs:{name:m,type:d?u:"button",disabled:v||b},on:_ctor.default.objectMap(a,function(t,e){return function(t){return s.$emit(e,{$event:t},t)}})},this.renderContent(t))},methods:{renderContent:function(t){var e=this.$scopedSlots,n=this.content,o=this.icon,i=[];return this.loading?i.push(t("i",{class:["vxe-button--loading-icon",_conf.default.icon.BUTTON_LOADING]})):o&&i.push(t("i",{class:["vxe-button--icon",o]})),e.default?i.push(t("span",{class:"vxe-button--content"},e.default.call(this))):n&&i.push(t("span",{class:"vxe-button--content"},[_tools.UtilTools.getFuncText(n)])),i},handleGlobalMousewheelEvent:function(t){this.showPanel&&!_tools.DomTools.getEventTargetNode(t,this.$refs.panel).flag&&this.closePanel()},updateZindex:function(){this.panelIndex<_tools.UtilTools.getLastZIndex()&&(this.panelIndex=_tools.UtilTools.nextZIndex())},clickDropdownEvent:function(t){var e=this,n=t.currentTarget,o=this.$refs.panel,i=_tools.DomTools.getEventTargetNode(t,n,"vxe-button"),s=i.flag,r=i.targetElem;s&&(o&&(o.dataset.active="N"),this.showPanel=!1,setTimeout(function(){o&&"Y"===o.dataset.active||(e.animatVisible=!1)},350),this.$emit("dropdown-click",{name:r.getAttribute("name"),$event:t},t))},mouseenterTargetEvent:function(){var t=this,e=this.$refs.panel;e.dataset.active="Y",this.inited||(this.inited=!0,this.transfer&&document.body.appendChild(e)),this.showTime=setTimeout(function(){"Y"===e.dataset.active?t.mouseenterEvent():t.animatVisible=!1},250)},mouseenterEvent:function(){var t=this,e=this.$refs.panel;e.dataset.active="Y",this.animatVisible=!0,setTimeout(function(){"Y"===e.dataset.active&&(t.showPanel=!0,t.updateZindex(),t.updatePlacement(),setTimeout(function(){t.showPanel&&t.updatePlacement()},50))},20)},mouseleaveEvent:function(){this.closePanel()},closePanel:function(){var t=this,e=this.$refs.panel;clearTimeout(this.showTime),e?(e.dataset.active="N",setTimeout(function(){"Y"!==e.dataset.active&&(t.showPanel=!1,setTimeout(function(){"Y"!==e.dataset.active&&(t.animatVisible=!1)},350))},100)):(this.animatVisible=!1,this.showPanel=!1)},updatePlacement:function(){var _=this;return this.$nextTick().then(function(){var t=_.$refs,e=_.transfer,n=_.placement,o=_.panelIndex,i=t.btn,s=t.panel;if(s&&i){var r=i.offsetHeight,a=i.offsetWidth,l=s.offsetHeight,u=s.offsetWidth,c={zIndex:o},d=_tools.DomTools.getAbsolutePos(i),f=d.boundingTop,p=d.boundingLeft,h=d.visibleHeight,m=d.visibleWidth,v="bottom";if(e){var b=p,y=f+r;"top"===n?(v="top",y=f-l):n||(h<y+l+5&&(v="top",y=f-l),y<5&&(v="bottom",y=f+r)),m<b+u+5&&(b-=b+u+5-m),b<5&&(b=5),Object.assign(c,{left:"".concat(b,"px"),top:"".concat(y,"px"),minWidth:"".concat(a,"px")})}else"top"===n?(v="top",c.bottom="".concat(r,"px")):n||h<f+r+l&&5<f-r-l&&(v="top",c.bottom="".concat(r,"px"));return _.panelStyle=c,_.panelPlacement=v,_.$nextTick()}})},focus:function(){return this.$el.focus(),this.$nextTick()},blur:function(){return this.$el.blur(),this.$nextTick()}}};exports.default=_default2;